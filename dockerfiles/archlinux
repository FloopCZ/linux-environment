FROM cognexa/cxflow-tensorflow
MAINTAINER Filip Matzner <docker@floop.cz>

# install extra packages
RUN pacman --noconfirm --needed -S \
      arrayfire \
      base-devel \
      boost \
      cmake \
      cpulimit \
      clang \
      crypto++ \
      eigen \
      git \
      ipython \
      jupyter-nbconvert \
      jupyter-notebook \
      libclc \
      mathjax \
      opencv \
      openmp \
      openssh \
      parallel \
      pugixml \
      python-ipywidgets \
      yaml-cpp \
  && paccache -rfk0

# install linux environment
RUN cd /root \
  && git clone https://github.com/FloopCZ/linux-environment.git \
  && cd linux-environment \
  && ./deploy.sh --install \
  && paccache -rfk0
# install fresh cxflow                                          
RUN pip install --upgrade --no-cache-dir git+https://github.com/Cognexa/cxflow.git \
  && pip install --upgrade --no-cache-dir git+https://github.com/Cognexa/cxflow-scikit.git
# install fresh cxflow-tensorflow
RUN pip install --upgrade --no-cache-dir git+https://github.com/Cognexa/cxflow-tensorflow.git
# install cxtream
RUN git clone --recursive https://github.com/Cognexa/cxtream.git \
  && mkdir -p cxtream/build && cd cxtream/build \
  && cmake -DBUILD_TEST=OFF .. \
  && make -j4 && make install && ldconfig \
  && cd ../../ && rm -r cxtream
# install pycma
RUN pip install --upgrade --no-cache-dir git+https://github.com/CMA-ES/pycma.git
# install libcmaes
RUN sudo -u aur pacaur --noconfirm --noedit --needed -S libcmaes \
  && rm -rf ~/.cache \
  && paccache -rfk0
# install jupyter c++ support
RUN sudo -u aur pacaur --noconfirm --noedit --needed -S cling-jupyter-git cxxopts root \
  && rm -rf ~/.cache \
  && paccache -rfk0
RUN git clone --recursive https://github.com/QuantStack/xtl.git \
  && mkdir -p xtl/build && cd xtl/build \
  && cmake .. \
  && make -j4 && make install && ldconfig \
  && cd ../../ && rm -r xtl
RUN git clone --recursive https://github.com/QuantStack/xeus.git \
  && mkdir -p xeus/build && cd xeus/build \
  && cmake .. \
  && make -j4 && make install && ldconfig \
  && cd ../../ && rm -r xeus
RUN git clone --recursive https://github.com/QuantStack/xeus-cling.git \
  && mkdir -p xeus-cling/build && cd xeus-cling/build \
  && cmake .. \
  && make -j4 && make install && ldconfig \
  && cd ../../ && rm -r xeus-cling
# install jupyter nbextensions
RUN pip install --upgrade --no-cache-dir jupyter_contrib_nbextensions \
  && jupyter contrib nbextension install --system \
  && pip install --upgrade --no-cache-dir jupyter_nbextensions_configurator \
  && jupyter nbextensions_configurator enable --system
